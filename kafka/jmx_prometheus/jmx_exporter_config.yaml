rules:
  # ===========================================================
  # KAFKA BROKER METRICS
  # ===========================================================
  - pattern: 'kafka.server<type=BrokerTopicMetrics, name=BytesInPerSec, topic=(.+)><>Count'
    name: kafka_broker_topic_bytes_in_total
    labels: { topic: $1 }

  - pattern: 'kafka.server<type=BrokerTopicMetrics, name=BytesOutPerSec, topic=(.+)><>Count'
    name: kafka_broker_topic_bytes_out_total
    labels: { topic: $1 }

  - pattern: 'kafka.server<type=BrokerTopicMetrics, name=MessagesInPerSec, topic=(.+)><>Count'
    name: kafka_broker_topic_messages_in_total
    labels: { topic: $1 }

  - pattern: 'kafka.network<type=RequestMetrics, name=TotalTimeMs, request=(.+)><>Count'
    name: kafka_broker_request_total
    labels: { request: $1 }

  - pattern: 'kafka.network<type=RequestMetrics, name=TotalTimeMs, request=(.+)><>Mean'
    name: kafka_broker_request_latency_ms
    labels: { request: $1 }

  - pattern: 'kafka.log<type=Log, name=Size, topic=(.+), partition=(.+)><>Value'
    name: kafka_broker_log_size_bytes
    labels: { topic: $1, partition: $2 }

  # ===========================================================
  # KAFKA PRODUCER METRICS
  # ===========================================================
  - pattern: 'kafka.producer<type=producer-metrics, client-id=(.+)><>record-send-total'
    name: kafka_producer_records_sent_total
    labels: { client_id: $1 }

  - pattern: 'kafka.producer<type=producer-metrics, client-id=(.+)><>byte-total'
    name: kafka_producer_bytes_sent_total
    labels: { client_id: $1 }

  - pattern: 'kafka.producer<type=producer-metrics, client-id=(.+)><>request-total'
    name: kafka_producer_request_total
    labels: { client_id: $1 }

  - pattern: 'kafka.producer<type=producer-metrics, client-id=(.+)><>record-error-total'
    name: kafka_producer_record_errors_total
    labels: { client_id: $1 }

  - pattern: 'kafka.producer<type=producer-metrics, client-id=(.+)><>compression-rate-avg'
    name: kafka_producer_compression_ratio
    type: gauge
    labels: { client_id: $1 }

  - pattern: 'kafka.producer<type=producer-metrics, client-id=(.+)><>request-latency-avg'
    name: kafka_producer_request_latency_ms
    type: gauge
    labels: { client_id: $1 }

  # ===========================================================
  # KAFKA CONSUMER METRICS
  # ===========================================================
  - pattern: 'kafka.consumer<type=consumer-fetch-manager-metrics, client-id=(.+)><>records-consumed-total'
    name: kafka_consumer_records_consumed_total
    labels: { client_id: $1 }

  - pattern: 'kafka.consumer<type=consumer-fetch-manager-metrics, client-id=(.+)><>bytes-consumed-total'
    name: kafka_consumer_bytes_consumed_total
    labels: { client_id: $1 }

  - pattern: 'kafka.consumer<type=consumer-fetch-manager-metrics, client-id=(.+)><>fetch-latency-avg'
    name: kafka_consumer_fetch_latency_ms
    type: gauge
    labels: { client_id: $1 }

  - pattern: 'kafka.consumer<type=consumer-coordinator-metrics, client-id=(.+)><>commit-latency-avg'
    name: kafka_consumer_commit_latency_ms
    type: gauge
    labels: { client_id: $1 }

  - pattern: 'kafka.consumer<type=consumer-coordinator-metrics, client-id=(.+)><>assigned-partitions'
    name: kafka_consumer_assigned_partitions
    type: gauge
    labels: { client_id: $1 }
